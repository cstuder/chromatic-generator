!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){function n(t){function e(){a?(n(),O(e),i=!0,a=!1):i=!1}var n=t,a=!1,i=!1;this.kick=function(){a=!0,i||e()},this.end=function(t){var e=n;t&&(i?(n=a?function(){e(),t()}:t,a=!0):t())}}function a(){return!0}function i(){return!1}function o(t){t.preventDefault()}function r(t){z[t.target.tagName.toLowerCase()]||t.preventDefault()}function u(t){return 1===t.which&&!t.ctrlKey&&!t.altKey}function c(t,e){var n,a;if(t.identifiedTouch)return t.identifiedTouch(e);for(n=-1,a=t.length;++n<a;)if(t[n].identifier===e)return t[n]}function d(t,e){var n=c(t.changedTouches,e.identifier);if(n&&(n.pageX!==e.pageX||n.pageY!==e.pageY))return n}function m(t){var e;u(t)&&(e={target:t.target,startX:t.pageX,startY:t.pageY,timeStamp:t.timeStamp},K(document,Q.move,f,e),K(document,Q.cancel,s,e))}function f(t){var e=t.data;X(t,e,t,v)}function s(){v()}function v(){L(document,Q.move,f),L(document,Q.cancel,s)}function p(t){var e,n;z[t.target.tagName.toLowerCase()]||(e=t.changedTouches[0],n={target:e.target,startX:e.pageX,startY:e.pageY,timeStamp:t.timeStamp,identifier:e.identifier},K(document,B.move+"."+e.identifier,g,n),K(document,B.cancel+"."+e.identifier,h,n))}function g(t){var e=t.data,n=d(t,e);n&&X(t,e,n,l)}function h(t){var e=t.data,n=c(t.changedTouches,e.identifier);n&&l(e.identifier)}function l(t){L(document,"."+t,g),L(document,"."+t,h)}function X(t,e,n,a){var i=n.pageX-e.startX,o=n.pageY-e.startY;C*C>i*i+o*o||y(t,e,n,i,o,a)}function Y(){return this._handled=a,!1}function w(t){t._handled()}function y(t,e,n,a,i,o){{var r,u;e.target}r=t.targetTouches,u=t.timeStamp-e.timeStamp,e.type="movestart",e.distX=a,e.distY=i,e.deltaX=a,e.deltaY=i,e.pageX=n.pageX,e.pageY=n.pageY,e.velocityX=a/u,e.velocityY=i/u,e.targetTouches=r,e.finger=r?r.length:1,e._handled=Y,e._preventTouchmoveDefault=function(){t.preventDefault()},N(e.target,e),o(e.identifier)}function T(t){var e=t.data.timer;t.data.touch=t,t.data.timeStamp=t.timeStamp,e.kick()}function S(t){var e=t.data.event,n=t.data.timer;k(),F(e,n,function(){setTimeout(function(){L(e.target,"click",i)},0)})}function k(){L(document,Q.move,T),L(document,Q.end,S)}function _(t){var e=t.data.event,n=t.data.timer,a=d(t,e);a&&(t.preventDefault(),e.targetTouches=t.targetTouches,t.data.touch=a,t.data.timeStamp=t.timeStamp,n.kick())}function q(t){var e=t.data.event,n=t.data.timer,a=c(t.changedTouches,e.identifier);a&&(A(e),F(e,n))}function A(t){L(document,"."+t.identifier,_),L(document,"."+t.identifier,q)}function D(t,e,n){var a=n-t.timeStamp;t.type="move",t.distX=e.pageX-t.startX,t.distY=e.pageY-t.startY,t.deltaX=e.pageX-t.pageX,t.deltaY=e.pageY-t.pageY,t.velocityX=.3*t.velocityX+.7*t.deltaX/a,t.velocityY=.3*t.velocityY+.7*t.deltaY/a,t.pageX=e.pageX,t.pageY=e.pageY}function F(t,e,n){e.end(function(){return t.type="moveend",N(t.target,t),n&&n()})}function R(){return K(this,"movestart.move",w),!0}function x(){return L(this,"dragstart drag",o),L(this,"mousedown touchstart",r),L(this,"movestart",w),!0}function b(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(K(this,"dragstart."+t.guid+" drag."+t.guid,o,e,t.selector),K(this,"mousedown."+t.guid,r,e,t.selector))}function j(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(L(this,"dragstart."+t.guid+" drag."+t.guid),L(this,"mousedown."+t.guid))}var C=6,K=t.event.add,L=t.event.remove,N=function(e,n,a){t.event.trigger(n,a,e)},O=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}(),z={textarea:!0,input:!0,select:!0,button:!0},Q={move:"mousemove",cancel:"mouseup dragstart",end:"mouseup"},B={move:"touchmove",cancel:"touchend",end:"touchend"};t.event.special.movestart={setup:R,teardown:x,add:b,remove:j,_default:function(t){function a(){D(o,r.touch,r.timeStamp),N(t.target,o)}var o,r;t._handled()&&(o={target:t.target,startX:t.startX,startY:t.startY,pageX:t.pageX,pageY:t.pageY,distX:t.distX,distY:t.distY,deltaX:t.deltaX,deltaY:t.deltaY,velocityX:t.velocityX,velocityY:t.velocityY,timeStamp:t.timeStamp,identifier:t.identifier,targetTouches:t.targetTouches,finger:t.finger},r={event:o,timer:new n(a),touch:e,timeStamp:e},t.identifier===e?(K(t.target,"click",i),K(document,Q.move,T,r),K(document,Q.end,S,r)):(t._preventTouchmoveDefault(),K(document,B.move+"."+t.identifier,_,r),K(document,B.end+"."+t.identifier,q,r)))}},t.event.special.move={setup:function(){K(this,"movestart.move",t.noop)},teardown:function(){L(this,"movestart.move",t.noop)}},t.event.special.moveend={setup:function(){K(this,"movestart.moveend",t.noop)},teardown:function(){L(this,"movestart.moveend",t.noop)}},K(document,"mousedown.move",m),K(document,"touchstart.move",p),"function"==typeof Array.prototype.indexOf&&!function(t){for(var e=["changedTouches","targetTouches"],n=e.length;n--;)-1===t.event.props.indexOf(e[n])&&t.event.props.push(e[n])}(t)});
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(t){var e,i,s;e=t.currentTarget.offsetWidth,i=t.currentTarget.offsetHeight,s={distX:t.distX,distY:t.distY,velocityX:t.velocityX,velocityY:t.velocityY,finger:t.finger},t.distX>t.distY?t.distX>-t.distY?(t.distX/e>d.threshold||t.velocityX*t.distX/e*d.sensitivity>1)&&(s.type="swiperight",r(t.currentTarget,s)):(-t.distY/i>d.threshold||t.velocityY*t.distY/e*d.sensitivity>1)&&(s.type="swipeup",r(t.currentTarget,s)):t.distX>-t.distY?(t.distY/i>d.threshold||t.velocityY*t.distY/e*d.sensitivity>1)&&(s.type="swipedown",r(t.currentTarget,s)):(-t.distX/e>d.threshold||t.velocityX*t.distX/e*d.sensitivity>1)&&(s.type="swipeleft",r(t.currentTarget,s))}function i(e){var i=t.data(e,"event_swipe");return i||(i={count:0},t.data(e,"event_swipe",i)),i}var s=t.event.add,n=t.event.remove,r=function(e,i,s){t.event.trigger(i,s,e)},d={threshold:.4,sensitivity:6};t.event.special.swipe=t.event.special.swipeleft=t.event.special.swiperight=t.event.special.swipeup=t.event.special.swipedown={setup:function(t){var t=i(this);if(!(t.count++>0))return s(this,"moveend",e),!0},teardown:function(){var t=i(this);if(!(--t.count>0))return n(this,"moveend",e),!0},settings:d}});
!function(e){function n(e,n){for(var t=e.length;t--;)if(e[t]===n)return t;return-1}function t(e,n){if(e.length!=n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function o(e){for(m in b)b[m]=e[T[m]]}function r(e){var t,r,i,l,c,u;if(t=e.keyCode,-1==n(S,t)&&S.push(t),(93==t||224==t)&&(t=91),t in b){b[t]=!0;for(i in C)C[i]==t&&(f[i]=!0)}else if(o(e),f.filter.call(this,e)&&t in E)for(u=p(),l=0;l<E[t].length;l++)if(r=E[t][l],r.scope==u||"all"==r.scope){c=r.mods.length>0;for(i in b)(!b[i]&&n(r.mods,+i)>-1||b[i]&&-1==n(r.mods,+i))&&(c=!1);(0!=r.mods.length||b[16]||b[18]||b[17]||b[91])&&!c||r.method(e,r)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function i(e){var t,o=e.keyCode,r=n(S,o);if(r>=0&&S.splice(r,1),(93==o||224==o)&&(o=91),o in b){b[o]=!1;for(t in C)C[t]==o&&(f[t]=!1)}}function l(){for(m in b)b[m]=!1;for(m in C)f[m]=!1}function f(e,n,t){var o,r;o=g(e),void 0===t&&(t=n,n="all");for(var i=0;i<o.length;i++)r=[],e=o[i].split("+"),e.length>1&&(r=v(e),e=[e[e.length-1]]),e=e[0],e=P(e),e in E||(E[e]=[]),E[e].push({shortcut:o[i],scope:n,method:t,key:o[i],mods:r})}function c(e,n){var o,r,i,l,f,c=[];for(o=g(e),l=0;l<o.length;l++){if(r=o[l].split("+"),r.length>1&&(c=v(r)),e=r[r.length-1],e=P(e),void 0===n&&(n=p()),!E[e])return;for(i=0;i<E[e].length;i++)f=E[e][i],f.scope===n&&t(f.mods,c)&&(E[e][i]={})}}function u(e){return"string"==typeof e&&(e=P(e)),-1!=n(S,e)}function a(){return S.slice(0)}function s(e){var n=(e.target||e.srcElement).tagName;return!("INPUT"==n||"SELECT"==n||"TEXTAREA"==n)}function d(e){w=e||"all"}function p(){return w||"all"}function h(e){var n,t,o;for(n in E)for(t=E[n],o=0;o<t.length;)t[o].scope===e?t.splice(o,1):o++}function g(e){var n;return e=e.replace(/\s/g,""),n=e.split(","),""==n[n.length-1]&&(n[n.length-2]+=","),n}function v(e){for(var n=e.slice(0,e.length-1),t=0;t<n.length;t++)n[t]=C[n[t]];return n}function y(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent("on"+n,function(){t(window.event)})}function k(){var n=e.key;return e.key=A,n}var m,E={},b={16:!1,18:!1,17:!1,91:!1},w="all",C={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},K={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},P=function(e){return K[e]||e.toUpperCase().charCodeAt(0)},S=[];for(m=1;20>m;m++)K["f"+m]=111+m;var T={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(m in C)f[m]=!1;y(document,"keydown",function(e){r(e)}),y(document,"keyup",i),y(window,"focus",l);var A=e.key;e.key=f,e.key.setScope=d,e.key.getScope=p,e.key.deleteScope=h,e.key.filter=s,e.key.isPressed=u,e.key.getPressedKeyCodes=a,e.key.noConflict=k,e.key.unbind=c,"undefined"!=typeof module&&(module.exports=f)}(this);
var ArrayProto,nativeForEach,nativeIsArray,nativeMap,nativeReduce,__hasProp={}.hasOwnProperty;("undefined"==typeof _||null===_)&&(this._={},ArrayProto=Array.prototype,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeIsArray=Array.isArray,_.isObject=function(n){var r;return r=typeof n,"function"===r||"object"===r&&!!n},_.after=function(n,r){return function(){return--n<1?r.apply(this,arguments):void 0}},_.each=function(n,r,t){var e,a,u,o,i,c;try{if(nativeForEach&&n.forEach===nativeForEach)n.forEach(r,t);else if(_.isNumber(n.length))for(a=i=0,c=n.length;c>=0?c>i:i>c;a=c>=0?++i:--i)r.call(t,n[a],a,n);else for(u in n)__hasProp.call(n,u)&&(o=n[u],r.call(t,o,u,n))}catch(l){e=l}return n},_.map=function(n,r,t){var e;return nativeMap&&n.map===nativeMap?n.map(r,t):(e=[],_.each(n,function(n,a,u){return e.push(r.call(t,n,a,u))}),e)},_.reduce=function(n,r,t,e){return nativeReduce&&n.reduce===nativeReduce?(e&&(r=_.bind(r,e)),n.reduce(r,t)):(_.each(n,function(n,a,u){return t=r.call(e,t,n,a,u)}),t)},_.isArray=nativeIsArray||function(n){return!(!(n&&n.concat&&n.unshift)||n.callee)},_.max=function(n,r,t){var e;return!r&&_.isArray(n)?Math.max.apply(Math,n):(e={computed:-1/0},_.each(n,function(n,a,u){var o;return o=r?r.call(t,n,a,u):n,o>=e.computed&&(e={value:n,computed:o})}),e.value)},_.min=function(n,r,t){var e;return!r&&_.isArray(n)?Math.min.apply(Math,n):(e={computed:1/0},_.each(n,function(n,a,u){var o;return o=r?r.call(t,n,a,u):n,o<e.computed&&(e={value:n,computed:o})}),e.value)},_.now=Date.now||function(){return(new Date).getTime()},_.throttle=function(n,r,t){var e,a,u,o,i,c;return a=void 0,e=void 0,i=void 0,c=null,o=0,t||(t={}),u=function(){o=t.leading===!1?0:_.now(),c=null,i=n.apply(a,e),a=e=null},function(){var l,v;return l=_.now(),o||t.leading!==!1||(o=l),v=r-(l-o),a=this,e=arguments,0>=v?(clearTimeout(c),c=null,o=l,i=n.apply(a,e),a=e=null):c||t.trailing===!1||(c=setTimeout(u,v)),i}},_.debounce=function(n,r,t){var e,a,u,o,i,c;return i=void 0,e=void 0,a=void 0,c=void 0,o=void 0,u=function(){var l;l=_.now()-c,r>l?i=setTimeout(u,r-l):(i=null,t||(o=n.apply(a,e),a=e=null))},function(){var l;return a=this,e=arguments,c=_.now(),l=t&&!i,i||(i=setTimeout(u,r)),l&&(o=n.apply(a,e),a=e=null),o}});
(function(){var t,o,i=function(t,o){return function(){return t.apply(o,arguments)}};this.Chromatic=this.Chromatic||{},t=function(){var t;return t={},function(o,i){var e,s,h,r,n,u,a,c,p,l,m,d,w,v;if(r=o.join()+i,t[r])return t[r];if(u=o.length,0>=i)return[];if(i>u)return o.map(function(t){return[t]});for(c=function(){var t,o;for(o=[],l=t=0;u>=0?u>t:t>u;l=u>=0?++t:--t)o.push(function(){var t,o;for(o=[],p=t=0;i>=0?i>t:t>i;p=i>=0?++t:--t)o.push(0);return o}());return o}(),a=function(){var t,o,e;for(e=[],l=t=0,o=u-1;o>=0?o>t:t>o;l=o>=0?++t:--t)e.push(function(){var t,o,e;for(e=[],p=t=0,o=i-1;o>=0?o>t:t>o;p=o>=0?++t:--t)e.push(0);return e}());return e}(),s=m=0;u>=0?u>m:m>u;s=u>=0?++m:--m)c[s][0]=o[s]+(s?c[s-1][0]:0);for(h=d=0;i>=0?i>d:d>i;h=i>=0?++d:--d)c[0][h]=o[0];for(s=w=1;u>=1?u>w:w>u;s=u>=1?++w:--w)for(h=v=1;i>=1?i>v:v>i;h=i>=1?++v:--v)n=_.min(function(){var t,o;for(o=[],p=t=0;s>=0?s>t:t>s;p=s>=0?++t:--t)o.push([_.max([c[p][h-1],c[s][0]-c[p][0]]),p]);return o}(),function(t){return t[0]}),c[s][h]=n[0],a[s-1][h-1]=n[1];for(u-=1,i-=2,e=[];i>=0;)e=[function(){var t,e,h,r;for(r=[],s=t=e=a[u-1][i]+1,h=u+1;h>=e?h>t:t>h;s=h>=e?++t:--t)r.push(o[s]);return r}()].concat(e),u=a[u-1][i],i-=1;return t[r]=[function(){var t,i,e;for(e=[],s=t=0,i=u+1;i>=0?i>t:t>i;s=i>=0?++t:--t)e.push(o[s]);return e}()].concat(e)}}(),o=function(){var t;return t=null,function(){var o,i,e;return t?t:(o=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>'),$(document.body).append(o),i=$("div",o).innerWidth(),o.css("overflow-y","auto"),e=$("div",o).innerWidth(),$(o).remove(),t=i-e)}}(),Chromatic.GalleryView=function(){function e(t,o,e){this.zoom=i(this.zoom,this),this.layout=i(this.layout,this),this.lazyLoad=i(this.lazyLoad,this),this.calculateAspectRatios=i(this.calculateAspectRatios,this),t[0]===document.body?(this.el=$('<div class="chromatic-gallery-full"/>'),$(t).append(this.el)):this.el=$(t).addClass("chromatic-gallery"),this.photos=_.map(o,function(t){return _.isObject(t)?t:{small:t}}),this.zoom_view=new Chromatic.ZoomView(this.photos,e),this.photo_views=_.map(this.photos,function(t){return function(o){return new Chromatic.GalleryPhotoView(t,o,e)}}(this)),this.ideal_height=parseInt(this.el.children().first().css("height")),$(window).on("resize",_.debounce(this.layout,100)),this.el.on("scroll",_.throttle(this.lazyLoad,100)),this.photos[0].aspect_ratio?this.layout():this.calculateAspectRatios()}return e.prototype.calculateAspectRatios=function(){var t;return t=_.after(this.photos.length,this.layout),_.each(this.photo_views,function(o){return o.load(t)})},e.prototype.lazyLoad=function(){var t,o,i;return t=1e3,i=this.el.scrollTop()-t,o=(this.el.height()||$(window).height())+this.el.scrollTop()+t,_.each(this.photo_views,function(){return function(t){return t.top<o&&t.bottom>i?t.load():t.unload()}}(this))},e.prototype.layout=function(){var i,e,s,h,r,n,u;return $(document.body).css("overflowY","scroll"),n=this.el[0].getBoundingClientRect().width-parseInt(this.el.css("paddingLeft"))-parseInt(this.el.css("paddingRight")),this.el[0].offsetWidth>this.el[0].scrollWidth&&(n-=o()),$(document.body).css("overflowY","auto"),i=this.ideal_height||parseInt((this.el.height()||$(window).height())/2),r=_.reduce(this.photos,function(t,o){return t+=o.aspect_ratio*i},0),h=Math.round(r/n),1>h?_.each(this.photos,function(t){return function(o,e){return t.photo_views[e].resize(parseInt(i*o.aspect_ratio),i)}}(this)):(u=_.map(this.photos,function(t){return parseInt(100*t.aspect_ratio)}),s=t(u,h),e=0,_.each(s,function(t){return function(o){var i,s;return i=[],_.each(o,function(o,s){return i.push(t.photos[e+s])}),s=_.reduce(i,function(t,o){return t+=o.aspect_ratio},0),r=0,_.each(i,function(o,h){var u,a;return a=h===i.length-1?n-r:parseInt(n/s*o.aspect_ratio),u=parseInt(n/s),t.photo_views[e+h].resize(a,u),r+=a}),e+=o.length}}(this))),this.lazyLoad()},e.prototype.zoom=function(t){return this.zoom_view.show(t)},e}()}).call(this),function(){var t=function(t,o){return function(){return t.apply(o,arguments)}};this.Chromatic=this.Chromatic||{},Chromatic.GalleryPhotoView=function(){function o(o,i){this.zoom=t(this.zoom,this),this.unload=t(this.unload,this),this.load=t(this.load,this),this.parent=o,this.photo=i,this.el=$('<div class="chromatic-gallery-photo"/>'),o.el.append(this.el),this.el.on("click",this.zoom)}return o.prototype.load=function(t){var o;if(!this.loaded)return o=new Image,o.onload=function(i){return function(){return i.photo.aspect_ratio=o.width/o.height,t&&t(),i.el.css("backgroundImage","url("+i.photo.small+")"),i.loaded=!0}}(this),o.src=this.photo.small},o.prototype.unload=function(){return this.el.css("backgroundImage",""),this.loaded=!1},o.prototype.zoom=function(){return this.parent.zoom(this.photo)},o.prototype.resize=function(t,o){return this.el.css({width:t-parseInt(this.el.css("marginLeft"))-parseInt(this.el.css("marginRight")),height:o-parseInt(this.el.css("marginTop"))-parseInt(this.el.css("marginBottom"))}),this.top=this.el.position().top,this.bottom=this.top+this.el.height()},o}()}.call(this),function(){var t=function(t,o){return function(){return t.apply(o,arguments)}};this.Chromatic=this.Chromatic||{},$.extend($.easing,{easeOutCirc:function(t,o,i,e,s){return e*Math.sqrt(1-(o=o/s-1)*o)+i}}),jQuery.event.special.swipe.settings.sensitivity=100,Chromatic.ZoomView=function(){function o(o){this.cancel=t(this.cancel,this),this.move=t(this.move,this),this.layout=t(this.layout,this),this.hideArrows=t(this.hideArrows,this),this.showArrows=t(this.showArrows,this),this.showPrevious=t(this.showPrevious,this),this.showNext=t(this.showNext,this),this.show=t(this.show,this),this.close=t(this.close,this),this.el=$('<div class="chromatic-zoom"/>'),this.el.html('<div class="chromatic-zoom-arrow-left"></div><div class="chromatic-zoom-arrow-right"></div>'),this.photos=o,$(document.body).append(this.el),this.el.hide().on("click swipeup",this.close).on("mousemove mouseenter",this.showArrows).on("mouseleave",this.hideArrows).on("click",".chromatic-zoom-arrow-left",this.showPrevious).on("swiperight",this.showPrevious).on("click",".chromatic-zoom-arrow-right",this.showNext).on("swipeleft",this.showNext).on("move",this.move).on("swipecanceled",this.cancel),this._debouncedLayout=_.debounce(function(t){return function(){return t.layout()}}(this),100)}return o.prototype.close=function(){return $(document.body).css("overflowY","auto"),clearTimeout(this.arrows_timer),key.unbind("esc"),key.unbind("enter"),key.unbind("up"),key.unbind("left"),key.unbind("j"),key.unbind("right"),key.unbind("k"),this.el.fadeOut(500,function(t){return function(){return t.previous_zoom_photo_view.remove(),t.current_zoom_photo_view.remove(),t.next_zoom_photo_view.remove(),t.previous_zoom_photo_view=null,t.current_zoom_photo_view=null,t.next_zoom_photo_view=null}}(this))},o.prototype.show=function(t){var o,i;return $(document.body).css("overflowY","hidden"),key("esc, enter, up",this.close),key("left, k",_.debounce(this.showPrevious,100,!0)),key("right, j",_.debounce(this.showNext,100,!0)),$(window).on("resize orientationchange",this._debouncedLayout),this.hideArrows(!1),this.el.fadeIn(500),this.previous_zoom_photo_view&&this.previous_zoom_photo_view.remove(),this.current_zoom_photo_view&&this.current_zoom_photo_view.remove(),this.next_zoom_photo_view&&this.next_zoom_photo_view.remove(),i=this.photos[this.photos.indexOf(t)-1]||this.photos[this.photos.length-1],this.current=t,o=this.photos[this.photos.indexOf(t)+1]||this.photos[0],this.previous_zoom_photo_view=new Chromatic.ZoomPhotoView(this,i),this.current_zoom_photo_view=new Chromatic.ZoomPhotoView(this,this.current),this.next_zoom_photo_view=new Chromatic.ZoomPhotoView(this,o),this.layout(),this.el.show()},o.prototype.showNext=function(t){var o;return t&&(t.preventDefault(),t.stopPropagation(),"keydown"===t.type?this.hideArrows():this.showArrows()),this.previous_zoom_photo_view.remove(),this.previous_zoom_photo_view=null,this.previous_zoom_photo_view=this.current_zoom_photo_view,this.current_zoom_photo_view=this.next_zoom_photo_view,this.current=this.photos[this.photos.indexOf(this.current)+1]||this.photos[0],o=this.photos[this.photos.indexOf(this.current)+1]||this.photos[0],this.next_zoom_photo_view=new Chromatic.ZoomPhotoView(this,o),this.previous_zoom_photo_view.layout("previous",0,!0),this.current_zoom_photo_view.layout("current",0,!0),this.next_zoom_photo_view.layout("next",0,!1)},o.prototype.showPrevious=function(t){var o;return t&&(t.preventDefault(),t.stopPropagation(),"keydown"===t.type?this.hideArrows():this.showArrows()),this.next_zoom_photo_view.remove(),this.next_zoom_photo_view=null,this.next_zoom_photo_view=this.current_zoom_photo_view,this.current_zoom_photo_view=this.previous_zoom_photo_view,this.current=this.photos[this.photos.indexOf(this.current)-1]||this.photos[this.photos.length-1],o=this.photos[this.photos.indexOf(this.current)-1]||this.photos[this.photos.length-1],this.previous_zoom_photo_view=new Chromatic.ZoomPhotoView(this,o),this.next_zoom_photo_view.layout("next",0,!0),this.current_zoom_photo_view.layout("current",0,!0),this.previous_zoom_photo_view.layout("previous",0,!1)},o.prototype.showArrows=function(){return this.el.find(".chromatic-zoom-arrow-left, .chromatic-zoom-arrow-right").stop().animate({opacity:1},200),clearTimeout(this.arrows_timer),this.arrows_timer=window.setTimeout(function(t){return function(){return t.hideArrows(!0)}}(this),3e3)},o.prototype.hideArrows=function(t){return this.el.find(".chromatic-zoom-arrow-left, .chromatic-zoom-arrow-right").animate({opacity:.01},null!=t?t:{1e3:0})},o.prototype.layout=function(t,o){return null==t&&(t=0),this.current_zoom_photo_view.layout("current",t,o),this.previous_zoom_photo_view.layout("previous",t,o),this.next_zoom_photo_view.layout("next",t,o)},o.prototype.move=function(t){return this.layout(t.distX,!1)},o.prototype.cancel=function(){return this.layout(0,!0)},o}()}.call(this),function(){var t,o=function(t,o){return function(){return t.apply(o,arguments)}};this.Chromatic=this.Chromatic||{},t=function(){var t;return t="dontknow",function(){var o;return"dontknow"!==t?t:(o=$("<div/>"),$(document.body).append(o),o[0].style.webkitFilter="grayscale(1)",t="grayscale(1)"===window.getComputedStyle(o[0]).webkitFilter,o.remove(),t)}}(),Chromatic.ZoomPhotoView=function(){function i(t,i){this.layout=o(this.layout,this),this.render=o(this.render,this),this.remove=o(this.remove,this),this.photo=i,this.el=$("<div/>"),this.render(),t.el.append(this.el)}return i.prototype.remove=function(){return this.el.remove()},i.prototype.render=function(){var o;return this.photo_el=$('<div class="chromatic-zoom-photo"></div>'),this.grain_el=$('<div class="chromatic-zoom-grain"></div>'),this.background_el=$('<div class="chromatic-zoom-background"></div>'),this.photo.big&&(o=new Image,o.onload=function(t){return function(){return t.photo_el.css("backgroundImage","url("+t.photo.big+")")}}(this),o.src=this.photo.big),this.photo_el.css("backgroundImage","url("+this.photo.small+")"),this.photo.blur?this.background_el.css("backgroundImage","url("+this.photo.blur+")"):t()&&this.background_el.addClass("chromatic-zoom-background-blur").css("backgroundImage","url("+this.photo.small+")"),this.el.append(this.photo_el,this.grain_el,this.background_el),this},i.prototype.layout=function(t,o,i){var e,s,h,r,n;return null==o&&(o=0),e=$(window),e.width()/e.height()>this.photo.aspect_ratio?(s=e.height(),n=e.height()*this.photo.aspect_ratio):(s=e.width()/this.photo.aspect_ratio,n=e.width()),this.photo_el.css({height:s,width:n,top:(e.height()-s)/2}),h=function(){switch(t){case"previous":return-n-20+o;case"current":return(e.width()-n)/2+o;case"next":return e.width()+20+o}}(),r=function(){switch(t){case"current":return 1-Math.abs(o)/e.width()*2;case"previous":return 0+o/e.width()*2;case"next":return 0-o/e.width()*2}}(),i?(this.photo_el.stop().animate({left:h},600,"easeOutCirc"),this.grain_el.stop().animate({opacity:r},600,"easeOutCirc"),this.background_el.stop().animate({opacity:r},600,"easeOutCirc")):(this.photo_el.css("left",h),this.grain_el.css("opacity",r),this.background_el.css("opacity",r))},i}()}.call(this),function(){$.fn.extend({chromatic:function(t,o){return new Chromatic.GalleryView(this,t,o),this}})}.call(this);